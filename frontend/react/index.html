<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legal AI.d - React Interface</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        #root {
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header {
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 42px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header-subtitle {
            color: #64748b;
            font-size: 16px;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            align-items: start;
        }

        .sidebar {
            padding: 25px;
        }

        .search-box {
            margin-bottom: 25px;
        }

        .search-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            margin-bottom: 10px;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .search-btn:hover {
            transform: translateY(-2px);
        }

        .search-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .examples {
            margin-top: 20px;
        }

        .examples-title {
            font-size: 14px;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 10px;
        }

        .example-btn {
            width: 100%;
            padding: 12px;
            background: #f1f5f9;
            border: none;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            margin-bottom: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .example-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 25px;
        }

        .stat-card {
            background: #f8fafc;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            font-size: 12px;
            color: #64748b;
            margin-top: 5px;
        }

        .content-area {
            padding: 30px;
            min-height: 500px;
        }

        .welcome-state {
            text-align: center;
            padding: 60px 20px;
        }

        .welcome-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .welcome-title {
            font-size: 28px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 10px;
        }

        .welcome-text {
            color: #64748b;
            font-size: 16px;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .answer-section {
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .answer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .answer-title {
            font-size: 24px;
            font-weight: 700;
            color: #1e293b;
        }

        .action-btns {
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            padding: 10px 16px;
            background: #f1f5f9;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .icon-btn:hover {
            background: #667eea;
            color: white;
        }

        .answer-text {
            line-height: 1.8;
            color: #334155;
            margin-bottom: 25px;
        }

        .answer-text h1, .answer-text h2, .answer-text h3 {
            margin: 20px 0 10px 0;
            font-weight: 700;
        }

        .answer-text h1 { font-size: 24px; }
        .answer-text h2 { font-size: 20px; }
        .answer-text h3 { font-size: 18px; }

        .answer-text p {
            margin: 10px 0;
        }

        .answer-text strong {
            font-weight: 600;
            color: #667eea;
        }

        .answer-text ul {
            margin: 10px 0 10px 20px;
            list-style-type: disc;
        }

        .answer-text li {
            margin: 5px 0;
        }

        .sources-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #e2e8f0;
        }

        .sources-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #1e293b;
        }

        .source-card {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .source-doc {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
        }

        .source-meta {
            font-size: 14px;
            color: #64748b;
        }

        .metrics-bar {
            display: flex;
            justify-content: space-around;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            margin-top: 25px;
        }

        .metric {
            text-align: center;
        }

        .metric-value {
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
        }

        .metric-label {
            font-size: 12px;
            color: #64748b;
            margin-top: 5px;
        }

        .error-card {
            background: #fee2e2;
            color: #991b1b;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #ef4444;
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            #root {
                padding: 10px;
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 28px;
            }

            .header-subtitle {
                font-size: 14px;
            }

            .sidebar, .content-area {
                padding: 15px;
            }

            .search-input {
                padding: 12px;
                font-size: 14px;
            }

            .search-btn {
                padding: 12px;
                font-size: 14px;
            }

            .example-queries h3 {
                font-size: 14px;
            }

            .example-btn {
                padding: 8px 12px;
                font-size: 12px;
            }

            .answer-section h2 {
                font-size: 18px;
            }

            .answer-text {
                font-size: 14px;
            }

            .answer-text h1 {
                font-size: 18px;
            }

            .answer-text h2 {
                font-size: 16px;
            }

            .answer-text h3 {
                font-size: 14px;
            }

            .stats-bar {
                flex-direction: column;
                gap: 8px;
            }

            .stat-item {
                font-size: 12px;
            }

            .sources-section h3 {
                font-size: 16px;
            }

            .source-card {
                padding: 12px;
            }

            .source-title {
                font-size: 14px;
            }

            .source-details {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const API_BASE_URL = window.location.origin;

        function formatMarkdown(text) {
            let formatted = text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');

            formatted = formatted
                .replace(/^### (.+)$/gm, '<h3>$1</h3>')
                .replace(/^## (.+)$/gm, '<h2>$1</h2>')
                .replace(/^# (.+)$/gm, '<h1>$1</h1>');

            formatted = formatted.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            formatted = formatted.replace(/^- (.+)$/gm, '<li>$1</li>');
            formatted = formatted.replace(/(<li>[\s\S]+?<\/li>)/g, match => '<ul>' + match + '</ul>');

            formatted = formatted
                .split('\n\n')
                .map(para => para.trim())
                .filter(para => para)
                .map(para => '<p>' + para.replace(/\n/g, '<br>') + '</p>')
                .join('\n');

            return formatted;
        }

        function App() {
            const [query, setQuery] = useState('');
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState(null);
            const [error, setError] = useState(null);
            const [stats, setStats] = useState({ chunks: 0, model: '' });

            useEffect(() => {
                fetchStats();
            }, []);

            async function fetchStats() {
                try {
                    const response = await fetch(`${API_BASE_URL}/stats`);
                    const data = await response.json();
                    setStats({
                        chunks: data.total_chunks || 0,
                        model: data.embedding_model || 'N/A'
                    });
                } catch (err) {
                    console.error('Failed to fetch stats:', err);
                }
            }

            async function handleSearch() {
                if (!query.trim()) return;

                setLoading(true);
                setError(null);
                setResult(null);

                try {
                    const response = await fetch(`${API_BASE_URL}/chat`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            message: query,
                            conversation_history: []
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.detail || 'Request failed');
                    }

                    const data = await response.json();
                    setResult(data);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            }

            function setExampleQuery(exampleQuery) {
                setQuery(exampleQuery);
                setTimeout(() => handleSearch(), 100);
            }

            function copyAnswer() {
                if (result) {
                    navigator.clipboard.writeText(result.answer);
                    alert('Answer copied to clipboard!');
                }
            }

            return (
                <div className="app-container">
                    <div className="glass-card header">
                        <h1>‚öñÔ∏è Legal AI.d</h1>
                        <p className="header-subtitle">
                            AI-Powered Search for Nigerian Tax Reform Acts 2025-2026
                        </p>
                    </div>

                    <div className="main-layout">
                        <div className="glass-card sidebar">
                            <div className="search-box">
                                <input
                                    type="text"
                                    className="search-input"
                                    placeholder="Ask about Nigerian tax law..."
                                    value={query}
                                    onChange={(e) => setQuery(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                                />
                                <button
                                    className="search-btn"
                                    onClick={handleSearch}
                                    disabled={loading}
                                >
                                    {loading ? 'üîÑ Searching...' : 'üîç Search'}
                                </button>
                            </div>

                            <div className="examples">
                                <div className="examples-title">Example Queries</div>
                                <button className="example-btn" onClick={() => setExampleQuery('What is the VAT rate in Nigeria?')}>
                                    üí∞ What is the VAT rate?
                                </button>
                                <button className="example-btn" onClick={() => setExampleQuery('What is the commencement date?')}>
                                    üìÖ Commencement date
                                </button>
                                <button className="example-btn" onClick={() => setExampleQuery('Do freelancers need to register for VAT?')}>
                                    üë®‚Äçüíº Freelancer VAT rules
                                </button>
                                <button className="example-btn" onClick={() => setExampleQuery('What are the tax relief provisions?')}>
                                    üéØ Tax relief provisions
                                </button>
                            </div>

                            <div className="stats-grid">
                                <div className="stat-card">
                                    <div className="stat-value">{stats.chunks}</div>
                                    <div className="stat-label">Indexed Chunks</div>
                                </div>
                                <div className="stat-card">
                                    <div className="stat-value">5/5</div>
                                    <div className="stat-label">Tests Passed</div>
                                </div>
                            </div>
                        </div>

                        <div className="glass-card content-area">
                            {!loading && !result && !error && (
                                <div className="welcome-state">
                                    <div className="welcome-icon">üîç</div>
                                    <h2 className="welcome-title">Search Nigerian Tax Law</h2>
                                    <p className="welcome-text">
                                        Ask any question about the Nigerian Tax Reform Acts 2025-2026
                                        and get accurate answers with source citations.
                                    </p>
                                </div>
                            )}

                            {loading && (
                                <div className="loading">
                                    <div className="spinner"></div>
                                    <p>Searching Nigerian Tax Acts...</p>
                                </div>
                            )}

                            {error && (
                                <div className="error-card">
                                    <strong>Error:</strong> {error}
                                </div>
                            )}

                            {result && (
                                <div className="answer-section">
                                    <div className="answer-header">
                                        <h2 className="answer-title">üìñ Answer</h2>
                                        <div className="action-btns">
                                            <button className="icon-btn" onClick={copyAnswer}>
                                                üìã Copy
                                            </button>
                                        </div>
                                    </div>

                                    <div className="answer-text" dangerouslySetInnerHTML={{ __html: formatMarkdown(result.answer) }}></div>

                                    <div className="metrics-bar">
                                        <div className="metric">
                                            <div className="metric-value">{result.sources?.length || 0}</div>
                                            <div className="metric-label">Sources</div>
                                        </div>
                                        <div className="metric">
                                            <div className="metric-value">{result.retrieved_chunks || 0}</div>
                                            <div className="metric-label">Chunks</div>
                                        </div>
                                        <div className="metric">
                                            <div className="metric-value">
                                                {result.metadata?.tokens_used?.total || '-'}
                                            </div>
                                            <div className="metric-label">Tokens</div>
                                        </div>
                                    </div>

                                    {result.sources && result.sources.length > 0 && (
                                        <div className="sources-section">
                                            <h3 className="sources-title">üìö Source Documents</h3>
                                            {result.sources.map((source, index) => (
                                                <div key={index} className="source-card">
                                                    <div className="source-doc">
                                                        {index + 1}. {source.document}
                                                    </div>
                                                    <div className="source-meta">
                                                        {source.section && `Section ${source.section}`}
                                                        {source.title && source.title !== '(anonymous)' && ` - ${source.title}`}
                                                        {source.pages && ` ‚Ä¢ Pages ${source.pages}`}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
